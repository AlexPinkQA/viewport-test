<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Гра для Safari iOS – свайп + viewport</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: 100%;
            overflow: hidden; /* Важливо для гри */
            -webkit-overflow-scrolling: touch;
        }
        body {
            display: flex;
            flex-direction: column;
            font-family: -apple-system, sans-serif;
            background: #000;
            color: white;
        }

        header {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            text-align: center;
            transition: padding 0.3s ease;
            z-index: 10;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .shrunk {
            padding: 8px !important;
            font-size: 0.9em;
        }

        #game-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        footer {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            z-index: 10;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .hidden {
            opacity: 0;
            transform: translateY(100%);
            pointer-events: none;
        }

        /* Примусово ховаємо скролбар, але дозволяємо touch */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <header id="header">Ваша гра</header>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
    </div>
    <footer id="footer">Footer – сховати при свайпі вгору</footer>

    <script>
        // === Детекція Safari на iOS ===
        const isSafariiOS = () => {
            return /iPhone|iPad|iPod/.test(navigator.userAgent) &&
                   /WebKit/.test(navigator.userAgent) &&
                   !/CriOS/.test(navigator.userAgent) && // не Chrome
                   !/FXIOS/.test(navigator.userAgent);  // не Firefox
        };

        if (!isSafariiOS()) {
            document.body.innerHTML = '<div style="padding:20px;color:red;">Ця сторінка оптимізована лише для Safari на iPhone/iPad</div>';
        }

        // === Елементи ===
        const header = document.getElementById('header');
        const footer = document.getElementById('footer');
        const canvas = document.getElementById('game-canvas');
        const container = document.getElementById('game-container');

        let startY = 0;
        let isHidden = false;
        const SWIPE_THRESHOLD = 60; // пікселів

        // === Вимірювання viewport (оновлюємо Pixi canvas) ===
        function updateViewport() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            console.log('Viewport:', width, 'x', height);

            // Тут підключіть ваш PixiJS renderer
            // Приклад:
            // if (window.gameApp) {
            //     window.gameApp.renderer.resize(width, height);
            //     window.gameApp.stage.hitArea = new PIXI.Rectangle(0, 0, width, height);
            // }

            // Оновлюємо розмір canvas
            canvas.width = width;
            canvas.height = height;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';

            return { width, height };
        }

        // === Свайп обробка ===
        function handleTouchStart(e) {
            startY = e.touches[0].clientY;
        }

        function handleTouchEnd(e) {
            if (!startY) return;

            const endY = e.changedTouches[0].clientY;
            const diff = startY - endY; // > 0 = вгору

            if (Math.abs(diff) > SWIPE_THRESHOLD) {
                if (diff > 0 && !isHidden) {
                    // Свайп вгору → ховаємо
                    hideUI();
                } else if (diff < 0 && isHidden) {
                    // Свайп вниз → показуємо назад
                    showUI();
                }
            }

            startY = 0;
        }

        function hideUI() {
            isHidden = true;
            footer.classList.add('hidden');
            header.classList.add('shrunk');

            // Примусово "прокручуємо" на 1px, щоб Safari сховав адресну панель
            setTimeout(() => {
                window.scrollTo(0, 1);
            }, 100);

            setTimeout(updateViewport, 300); // після анімації
        }

        function showUI() {
            isHidden = false;
            footer.classList.remove('hidden');
            header.classList.remove('shrunk');
            setTimeout(updateViewport, 300);
        }

        // === Ініціалізація ===
        window.addEventListener('load', () => {
            updateViewport();

            // Додаємо touch події тільки на контейнері гри (або на body)
            document.addEventListener('touchstart', handleTouchStart, { passive: true });
            document.addEventListener('touchend', handleTouchEnd, { passive: true });

            // Оновлюємо при зміні орієнтації / хованні панелі
            window.addEventListener('resize', updateViewport);
            window.visualViewport?.addEventListener('resize', updateViewport);

            // Додатково: примусово ховаємо UI Safari
            setTimeout(() => window.scrollTo(0, 1), 500);
        });

        // === Глобальний доступ для TypeScript/PixiJS ===
        window.updateGameViewport = updateViewport;
        window.hideGameUI = hideUI;
        window.showGameUI = showUI;
    </script>
</body>
</html>
